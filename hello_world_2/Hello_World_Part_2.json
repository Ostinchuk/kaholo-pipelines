{"content":"{\"cells\":[{\"type\":\"devs.PMStartPoint\",\"size\":{\"width\":40,\"height\":39},\"outPorts\":[\" \"],\"inPorts\":[],\"ports\":{\"groups\":{\"in\":{\"position\":{\"name\":\"left\"},\"attrs\":{\".port-label\":{\"fill\":\"#000\"},\".port-body\":{\"fill\":\"#fff\",\"stroke\":\"#000\",\"r\":10,\"magnet\":true}},\"label\":{\"position\":{\"name\":\"left\",\"args\":{\"y\":10}}}},\"out\":{\"position\":{\"name\":\"right\"},\"attrs\":{\".port-label\":{\"fill\":\"#000\"},\".port-body\":{\"fill\":\"#fff\",\"stroke\":\"#000\",\"r\":10,\"magnet\":true}},\"label\":{\"position\":{\"name\":\"right\",\"args\":{\"y\":10}}}}},\"items\":[{\"id\":\" \",\"group\":\"out\",\"attrs\":{\".port-label\":{\"text\":\" \"}}}]},\"position\":{\"x\":2,\"y\":15},\"angle\":0,\"id\":\"39ff7528-16f5-4617-9d92-e1555c5a1931\",\"z\":1,\"attrs\":{\"rect\":{\"fill\":\"#2d3236\"}}},{\"type\":\"devs.MyImageModel\",\"size\":{\"width\":100,\"height\":73},\"inPorts\":[\" \"],\"outPorts\":[\"  \"],\"ports\":{\"groups\":{\"in\":{\"position\":{\"name\":\"left\"},\"attrs\":{\".port-label\":{\"fill\":\"#000\"},\".port-body\":{\"fill\":\"#fff\",\"stroke\":\"#000\",\"r\":10,\"magnet\":true}},\"label\":{\"position\":{\"name\":\"left\",\"args\":{\"y\":10}}}},\"out\":{\"position\":{\"name\":\"right\"},\"attrs\":{\".port-label\":{\"fill\":\"#000\"},\".port-body\":{\"fill\":\"#fff\",\"stroke\":\"#000\",\"r\":10,\"magnet\":true}},\"label\":{\"position\":{\"name\":\"right\",\"args\":{\"y\":10}}}}},\"items\":[{\"id\":\" \",\"group\":\"in\",\"attrs\":{\".port-label\":{\"text\":\" \"}}},{\"id\":\"  \",\"group\":\"out\",\"attrs\":{\".port-label\":{\"text\":\"  \"}}}]},\"position\":{\"x\":611,\"y\":1},\"angle\":0,\"id\":\"80637eed-b86a-44ee-9be9-9cc19952a36a\",\"z\":2,\"attrs\":{\"rect\":{\"stroke-width\":1,\"fill\":\"#2d3236\",\"fill-opacity\":0.5},\".label\":{\"text\":\"SendEmail\"},\".p_id\":{\"text\":\"61e5912b27ec040032a77dfe\"},\"image\":{\"xlink:href\":\"/plugins/SendMail/envelope.png\",\"ref-y\":50},\"text\":{\"text\":\"SendEmail\"}}},{\"type\":\"devs.MyImageModel\",\"size\":{\"width\":100,\"height\":73},\"inPorts\":[\" \"],\"outPorts\":[\"  \"],\"ports\":{\"groups\":{\"in\":{\"position\":{\"name\":\"left\"},\"attrs\":{\".port-label\":{\"fill\":\"#000\"},\".port-body\":{\"fill\":\"#fff\",\"stroke\":\"#000\",\"r\":10,\"magnet\":true}},\"label\":{\"position\":{\"name\":\"left\",\"args\":{\"y\":10}}}},\"out\":{\"position\":{\"name\":\"right\"},\"attrs\":{\".port-label\":{\"fill\":\"#000\"},\".port-body\":{\"fill\":\"#fff\",\"stroke\":\"#000\",\"r\":10,\"magnet\":true}},\"label\":{\"position\":{\"name\":\"right\",\"args\":{\"y\":10}}}}},\"items\":[{\"id\":\" \",\"group\":\"in\",\"attrs\":{\".port-label\":{\"text\":\" \"}}},{\"id\":\"  \",\"group\":\"out\",\"attrs\":{\".port-label\":{\"text\":\"  \"}}}]},\"position\":{\"x\":180,\"y\":1},\"angle\":0,\"id\":\"61fdbb93-cbdb-4664-8fc7-8170c6e7ba7c\",\"z\":3,\"attrs\":{\"rect\":{\"stroke-width\":1,\"fill-opacity\":0.5,\"fill\":\"#2d3236\"},\".label\":{\"text\":\"GetData\"},\".p_id\":{\"text\":\"61e590b527ec040032a777e2\"},\"image\":{\"xlink:href\":\"/plugins/HTTP-Requests/icon.png\",\"ref-y\":50},\"text\":{\"text\":\"GetData\"}}},{\"type\":\"devs.MyImageModel\",\"size\":{\"width\":100,\"height\":73},\"inPorts\":[\" \"],\"outPorts\":[\"  \"],\"ports\":{\"groups\":{\"in\":{\"position\":{\"name\":\"left\"},\"attrs\":{\".port-label\":{\"fill\":\"#000\"},\".port-body\":{\"fill\":\"#fff\",\"stroke\":\"#000\",\"r\":10,\"magnet\":true}},\"label\":{\"position\":{\"name\":\"left\",\"args\":{\"y\":10}}}},\"out\":{\"position\":{\"name\":\"right\"},\"attrs\":{\".port-label\":{\"fill\":\"#000\"},\".port-body\":{\"fill\":\"#fff\",\"stroke\":\"#000\",\"r\":10,\"magnet\":true}},\"label\":{\"position\":{\"name\":\"right\",\"args\":{\"y\":10}}}}},\"items\":[{\"id\":\" \",\"group\":\"in\",\"attrs\":{\".port-label\":{\"text\":\" \"}}},{\"id\":\"  \",\"group\":\"out\",\"attrs\":{\".port-label\":{\"text\":\"  \"}}}]},\"position\":{\"x\":402,\"y\":1},\"angle\":0,\"id\":\"77d8c660-e416-4047-b900-a032976b990a\",\"z\":4,\"attrs\":{\"rect\":{\"stroke-width\":1,\"fill-opacity\":0.5,\"fill\":\"#2d3236\"},\".label\":{\"text\":\"CreateHTML\"},\".p_id\":{\"text\":\"61e5907727ec040032a774f3\"},\"image\":{\"xlink:href\":\"/plugins/CommandLine/CommandLine.png\",\"ref-y\":50},\"text\":{\"text\":\"CreateHTML\"}}},{\"type\":\"link\",\"source\":{\"id\":\"61fdbb93-cbdb-4664-8fc7-8170c6e7ba7c\",\"port\":\"  \"},\"target\":{\"id\":\"77d8c660-e416-4047-b900-a032976b990a\",\"port\":\" \"},\"router\":{\"name\":\"manhattan\"},\"connector\":{\"name\":\"rounded\"},\"id\":\"a30d7e81-56e2-424c-96d0-8f93555eac95\",\"z\":6,\"attrs\":{\".connection\":{\"stroke\":\"#87939A\",\"stroke-width\":3},\".marker-target\":{\"fill\":\"#87939A\",\"d\":\"M 10 0 L 0 5 L 10 10 z\"}}},{\"type\":\"link\",\"source\":{\"id\":\"61fdbb93-cbdb-4664-8fc7-8170c6e7ba7c\",\"port\":\"  \"},\"target\":{\"id\":\"61fdbb93-cbdb-4664-8fc7-8170c6e7ba7c\",\"port\":\" \"},\"router\":{\"name\":\"manhattan\"},\"connector\":{\"name\":\"rounded\"},\"id\":\"4bd5fcfb-eeb1-421e-a227-49a72ff85958\",\"z\":13,\"attrs\":{\".connection\":{\"stroke\":\"#87939A\",\"stroke-width\":3},\".marker-target\":{\"fill\":\"#87939A\",\"d\":\"M 10 0 L 0 5 L 10 10 z\"}}},{\"type\":\"link\",\"source\":{\"id\":\"39ff7528-16f5-4617-9d92-e1555c5a1931\",\"port\":\" \"},\"target\":{\"id\":\"61fdbb93-cbdb-4664-8fc7-8170c6e7ba7c\",\"port\":\" \"},\"router\":{\"name\":\"manhattan\"},\"connector\":{\"name\":\"rounded\"},\"id\":\"1bdf13f7-9bde-4c8b-b1a4-0010a1702973\",\"z\":14,\"attrs\":{\".connection\":{\"stroke\":\"#87939A\",\"stroke-width\":3},\".marker-target\":{\"fill\":\"#87939A\",\"d\":\"M 10 0 L 0 5 L 10 10 z\"}}},{\"type\":\"link\",\"source\":{\"id\":\"77d8c660-e416-4047-b900-a032976b990a\",\"port\":\"  \"},\"target\":{\"id\":\"80637eed-b86a-44ee-9be9-9cc19952a36a\",\"port\":\" \"},\"router\":{\"name\":\"manhattan\"},\"connector\":{\"name\":\"rounded\"},\"id\":\"78ac111f-aabb-4035-ac43-dfbe30622f57\",\"z\":15,\"attrs\":{\".connection\":{\"stroke\":\"#87939A\",\"stroke-width\":3},\".marker-target\":{\"fill\":\"#87939A\",\"d\":\"M 10 0 L 0 5 L 10 10 z\"}}}]}","code":"/*\r\nThe global object to store and pass data between actions.\r\n*/\r\nDATA = {\r\n    \"coin_url\": \"\",\r\n    \"exchange_rates\": [],\r\n    \"message_subject\": \"\",\r\n    \"html_message\": \"\"\r\n}\r\n\r\n/*\r\nThis is a pre-execution function used in GetData action.\r\nThe function constracts URL for getting data from coinapi.io\r\nand store it in DATA object.\r\n*/\r\nfunction constractURL(currencyIndex) {\r\n    var baseUrl = kaholo.execution.configuration.coin_api;\r\n    var coin = kaholo.execution.configuration.coin;\r\n    var currency = kaholo.execution.configuration.currencies[currencyIndex];\r\n    kaholo.vault.getValueByKey(\"COIN_API_KEY\").then(function(key) {\r\n        DATA[\"coin_url\"] = `${baseUrl}/${coin}/${currency}?apikey=${key}`\r\n    });\r\n    \r\n}\r\n\r\n/*\r\nThis is a post-execution function used in GetData action.\r\nThe function extracts data from HTTP response and store it in DATA object.\r\n*/\r\nfunction extractData() {\r\n    var responseBody = actions.GetData.result.body;\r\n    var rate = responseBody.rate;\r\n    var currency = responseBody.asset_id_quote;\r\n\r\n    DATA[\"exchange_rates\"].push({\"currency\": currency, \"rate\": rate});\r\n}\r\n\r\n/*\r\nThis is a post-execution function used in CreateHTML action.\r\nThe function builds HTML message to be sent and store it in DATA object.\r\n*/\r\nfunction createHTML() {\r\n    var coin = kaholo.execution.configuration.coin;\r\n    DATA[\"message_subject\"] = `${coin} exchange rates`;\r\n    \r\n    var header = `<h1>${coin} exchange rates</h1>`;\r\n\r\n    let rates = [];\r\n    for (let item of DATA[\"exchange_rates\"]){\r\n        rates.push(`<p>${item[\"currency\"]}: ${item[\"rate\"]}</p>`);\r\n    }\r\n    let body = `${rates.join('')}`;\r\n\r\n    DATA[\"html_message\"] = `${header}${body}`\r\n}\r\n","plugins":[],"processes":[{"id":"62128f7d8ec7ff0032d14ca8","uuid":"80637eed-b86a-44ee-9be9-9cc19952a36a","codeId":"SendEmail","name":"","description":"Sends email.","mandatory":true,"coordination":"","condition":"","preRun":"","postRun":"","filterAgents":"","actionsExecution":"series","actions":[{"retries":null,"timeout":null,"name":"","mandatory":true,"method":"sendMailBySMTP","params":[{"value":"kaholo.execution.configuration.gmail_host;","code":true,"id":"61e5912b27ec040032a77e36","_id":"61e5912b27ec040032a77e36","language":null,"viewName":"Host","name":"HOST","required":false,"param":"61e5912b27ec040032a77e36","type":"string"},{"value":"kaholo.execution.configuration.gmail_port;","code":true,"id":"61e5912b27ec040032a77e37","_id":"61e5912b27ec040032a77e37","language":null,"viewName":"Port","name":"PORT","required":false,"param":"61e5912b27ec040032a77e37","type":"string"},{"value":"kaholo.vault.getValueByKey(\"GMAIL_USERNAME\");","code":true,"id":"61e5912b27ec040032a77e38","_id":"61e5912b27ec040032a77e38","language":null,"viewName":"Username","name":"USERNAME","required":false,"param":"61e5912b27ec040032a77e38","type":"string"},{"value":"kaholo.vault.getValueByKey(\"GMAIL_APP_PASSWORD\");","code":true,"id":"61e5912b27ec040032a77e39","_id":"61e5912b27ec040032a77e39","language":null,"viewName":"Password","name":"PASSWORD","required":false,"param":"61e5912b27ec040032a77e39","type":"string"},{"value":"kaholo.vault.getValueByKey(\"GMAIL_USERNAME\");","code":true,"id":"61e5912b27ec040032a77e3a","_id":"61e5912b27ec040032a77e3a","language":null,"viewName":"From","name":"FROM","required":false,"param":"61e5912b27ec040032a77e3a","type":"string"},{"value":"kaholo.vault.getValueByKey(\"GMAIL_USERNAME\");","code":true,"id":"61e5912b27ec040032a77e3b","_id":"61e5912b27ec040032a77e3b","language":null,"viewName":"to","name":"TO","required":false,"param":"61e5912b27ec040032a77e3b","type":"string"},{"value":null,"code":null,"id":"61e5912b27ec040032a77e3c","_id":"61e5912b27ec040032a77e3c","language":null,"viewName":"cc","name":"CC","required":false,"param":"61e5912b27ec040032a77e3c","type":"string"},{"value":null,"code":null,"id":"61e5912b27ec040032a77e3d","_id":"61e5912b27ec040032a77e3d","language":null,"viewName":"bcc","name":"BCC","required":false,"param":"61e5912b27ec040032a77e3d","type":"string"},{"value":"DATA[\"message_subject\"]","code":true,"id":"61e5912b27ec040032a77e3e","_id":"61e5912b27ec040032a77e3e","language":null,"viewName":"Message subject","name":"SUBJECT","required":false,"param":"61e5912b27ec040032a77e3e","type":"string"},{"value":null,"code":null,"id":"61e5912b27ec040032a77e3f","_id":"61e5912b27ec040032a77e3f","language":null,"viewName":"Plaintext message","name":"TEXT","required":false,"param":"61e5912b27ec040032a77e3f","type":"string"},{"value":"DATA[\"html_message\"]","code":true,"id":"61e5912b27ec040032a77e40","_id":"61e5912b27ec040032a77e40","language":null,"viewName":"Html message","name":"HTML","required":false,"param":"61e5912b27ec040032a77e40","type":"string"}],"isEnabled":true,"numParallel":""}],"used_plugin":{"name":"SendMail","version":"1.2.4"},"correlateAgents":null,"numProcessParallel":""},{"id":"62129f378ec7ff0032d15497","uuid":"61fdbb93-cbdb-4664-8fc7-8170c6e7ba7c","codeId":"GetData","name":"","description":"Extracts and transforms data from https://coinapi.io","mandatory":true,"coordination":"","condition":"kaholo.execution.configuration.currency_index < kaholo.execution.configuration.currencies.length;","preRun":"constractURL(kaholo.execution.configuration.currency_index);","postRun":"extractData();\r\n\r\nkaholo.execution.configuration.currency_index++;","filterAgents":"","actionsExecution":"series","actions":[{"retries":null,"timeout":null,"name":"","mandatory":true,"method":"sendRequest","params":[{"value":"GET","code":null,"id":"61e590b527ec040032a777e4","_id":"61e590b527ec040032a777e4","language":null,"viewName":"Method","name":"method","required":false,"param":"61e590b527ec040032a777e4","type":"options"},{"value":"DATA[\"coin_url\"]","code":true,"id":"61e590b527ec040032a777ea","_id":"61e590b527ec040032a777ea","language":null,"viewName":"URL","name":"url","required":false,"param":"61e590b527ec040032a777ea","type":"string"},{"value":null,"code":null,"id":"61e590b527ec040032a777eb","_id":"61e590b527ec040032a777eb","language":null,"viewName":"Body","name":"body","required":false,"param":"61e590b527ec040032a777eb","type":"string"},{"value":"","code":true,"id":"61e590b527ec040032a777ec","_id":"61e590b527ec040032a777ec","language":null,"viewName":"Headers (Obj)","name":"headers","required":false,"param":"61e590b527ec040032a777ec","type":"string"},{"value":null,"code":null,"id":"61e590b527ec040032a777ed","_id":"61e590b527ec040032a777ed","language":null,"viewName":"Username","name":"username","required":false,"param":"61e590b527ec040032a777ed","type":"string"},{"value":null,"code":null,"id":"61e590b527ec040032a777ee","_id":"61e590b527ec040032a777ee","language":null,"viewName":"Password","name":"password","required":false,"param":"61e590b527ec040032a777ee","type":"vault"},{"value":null,"code":null,"id":"61e590b527ec040032a777ef","_id":"61e590b527ec040032a777ef","language":null,"viewName":"Bearer Token","name":"bearerToken","required":false,"param":"61e590b527ec040032a777ef","type":"vault"}],"isEnabled":true,"numParallel":""}],"used_plugin":{"name":"HTTP-Requests","version":"1.1.4"},"correlateAgents":null,"numProcessParallel":""},{"id":"62129f378ec7ff0032d154a0","uuid":"77d8c660-e416-4047-b900-a032976b990a","codeId":"CreateHTML","name":"","description":"Creates an HTML message to be sent.","mandatory":true,"coordination":"","condition":"kaholo.execution.configuration.currency_index >= kaholo.execution.configuration.currencies.length;","preRun":"","postRun":"createHTML();","filterAgents":"","actionsExecution":"series","actions":[{"retries":null,"timeout":null,"name":"","mandatory":true,"method":"execute","params":[{"value":null,"code":null,"id":"61e5907727ec040032a774f5","_id":"61e5907727ec040032a774f5","language":null,"viewName":"Working Directory","name":"workingDir","required":false,"param":"61e5907727ec040032a774f5","type":"string"},{"value":"`echo \"Creating HTML message...\"`","code":true,"id":"61e5907727ec040032a774f6","_id":"61e5907727ec040032a774f6","language":null,"viewName":"Command","name":"COMMANDS","required":false,"param":"61e5907727ec040032a774f6","type":"string"},{"value":null,"code":null,"id":"61e5907727ec040032a774f7","_id":"61e5907727ec040032a774f7","language":null,"viewName":"Wait For Close","name":"exitOnClose","required":false,"param":"61e5907727ec040032a774f7","type":"boolean"},{"value":null,"code":null,"id":"61e5907727ec040032a774f8","_id":"61e5907727ec040032a774f8","language":null,"viewName":"Shell Type","name":"shell","required":false,"param":"61e5907727ec040032a774f8","type":"options"}],"isEnabled":true,"numParallel":""}],"used_plugin":{"name":"CommandLine","version":"3.0.2"},"correlateAgents":null,"numProcessParallel":""}],"configurations":[{"name":"hello_world_part_2","value":"{\n    \"gmail_host\": \"smtp.gmail.com\",\n    \"gmail_port\": 587,\n    \"coin_api\": \"https://rest.coinapi.io/v1/exchangerate\",\n    \"coin\": \"BTC\",\n    \"currencies\": [\"USD\", \"EUR\", \"GBP\"],\n    \"currency_index\": 0\n}","_id":"6212baba8ec7ff0032d16a0c"}],"links":[{"uuid":"a30d7e81-56e2-424c-96d0-8f93555eac95","sourceId":"61fdbb93-cbdb-4664-8fc7-8170c6e7ba7c","targetId":"77d8c660-e416-4047-b900-a032976b990a"},{"uuid":"4bd5fcfb-eeb1-421e-a227-49a72ff85958","sourceId":"61fdbb93-cbdb-4664-8fc7-8170c6e7ba7c","targetId":"61fdbb93-cbdb-4664-8fc7-8170c6e7ba7c"},{"uuid":"1bdf13f7-9bde-4c8b-b1a4-0010a1702973","sourceId":"39ff7528-16f5-4617-9d92-e1555c5a1931","targetId":"61fdbb93-cbdb-4664-8fc7-8170c6e7ba7c"},{"uuid":"78ac111f-aabb-4035-ac43-dfbe30622f57","sourceId":"77d8c660-e416-4047-b900-a032976b990a","targetId":"80637eed-b86a-44ee-9be9-9cc19952a36a"}],"used_plugins":[{"name":"SendMail","version":"1.2.4"},{"name":"HTTP-Requests","version":"1.1.4"},{"name":"CommandLine","version":"3.0.2"}],"exportedPipeline":{"description":"","queue":null}}